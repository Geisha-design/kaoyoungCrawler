graph TD
    A[前端请求] --> B{请求类型}
    B -->|POST /api/login| C[处理登录]
    B -->|POST /api/register| D[处理注册]
    
    C --> E[验证用户名密码]
    E --> F{验证成功?}
    F -->|是| G[生成JWT Token]
    F -->|否| H[返回错误信息]
    
    G --> I[检查客户端ID]
    I --> J{客户端ID存在?}
    J -->|是| K[查找/更新客户端记录]
    J -->|否| L[继续登录流程]
    
    K --> M[返回成功响应<br/>包含Token]
    L --> M
    
    D --> N[检查用户名是否存在]
    N --> O{用户名已存在?}
    O -->|是| P[返回冲突错误]
    O -->|否| Q[创建新用户]
    
    Q --> R[保存用户到数据库]
    R --> S[检查客户端ID]
    S --> T{客户端ID存在?}
    T -->|是| U[创建客户端记录]
    T -->|否| V[仅返回注册成功]
    
    U --> W[返回注册成功响应]
    V --> W
    P --> W
    H --> X[HTTP响应]
    M --> X
    W --> X
    
    style A fill:#e1f5fe
    style X fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#fff3e0
    style H fill:#ffebee
    style P fill:#ffebee
